
<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Gesundheitsplaner – Modern</title>
<style>
    :root {
      --primary-color: #4caf50;
      --secondary-color: #f0f4f8;
      --text-color: #333;
      --card-bg: #ffffff;
      --border-radius: 12px;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--secondary-color);
      color: var(--text-color);
      padding: 1rem;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      font-size: 1.8em;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    .block {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    label, input, select, button {
      display: block;
      width: 100%;
      font-size: 1rem;
      margin-bottom: 0.75rem;
    }

    input, select {
      padding: 0.6rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #388e3c;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: #e8f5e9;
      border-left: 5px solid #66bb6a;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
    }

    .calendar-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .calendar-controls button {
      width: auto;
      padding: 0.5rem 1rem;
    }

    @media (hover: none) {
      button:hover {
        background-color: var(--primary-color);
      }
    }

    @media screen and (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
    }
  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><link href="icon.png" rel="apple-touch-icon"/></head>
<body>
<h1>Gesundheitsplaner</h1>
<div class="block">
<h2>🕒 Medikamente</h2>
<label for="medName">Name des Medikaments</label>
<input id="medName" placeholder="z. B. Blutdrucktablette" type="text"/>
<label for="medDose">Dosierung</label>
<input id="medDose" placeholder="z. B. 1 Tablette" type="text"/>
<label for="medTime">Uhrzeit</label>
<input id="medTime" type="time"/>
<label for="medType">Einnahmeart</label>
<select id="medType">
<option>Tablette</option>
<option>Tropfen</option>
<option>Spray</option>
<option>Salbe</option>
<option>Sonstiges</option>
</select>
<button onclick="addMedication()">Medikament hinzufügen</button>
<ul id="medList"></ul>
</div>
<div class="block">
<h2>📅 Arzttermine</h2>
<label for="docDate">Datum</label>
<input id="docDate" type="date"/>
<label for="docTime">Uhrzeit</label>
<input id="docTime" type="time"/>
<label for="docName">Arztname oder Fachrichtung</label>
<input id="docName" placeholder="z. B. Hausarzt Dr. Müller" type="text"/>
<label for="docNote">Notiz</label>
<input id="docNote" placeholder="z. B. Blutuntersuchung" type="text"/>
<button onclick="addAppointment()">Termin hinzufügen</button>
<ul id="docList"></ul>
</div>
<div class="block">
<h2>📅 Übersichtskalender</h2>
<div class="calendar-controls">
<button onclick="changeMonth(-1)">◀ vorheriger Monat</button>
<span id="calendarMonth" style="font-weight:bold;"></span>
<button onclick="changeMonth(1)">nächster Monat ▶</button>
</div><div id="calendarExportBlock" style="padding: 1em; background: white;"><h2 id="calendarExportHeader" style="text-align:center; margin-bottom:0.5em; font-size:1.2em; color:#2e7d32;"></h2>
<div class="block" id="icsExportBlock" style="text-align: center;">
<h2>📅 Kalender-Export (iOS/Outlook)</h2>
<p>Mit einem Klick werden alle gespeicherten Medikamente und Arzttermine als .ics-Datei erstellt.</p>
<button onclick="exportICS()">📤 iCalendar-Datei herunterladen</button>
<p style="margin-top: 1em; font-size: 0.9em; color: #333;">📌 Hinweis: Wenn sich der Kalenderexport nicht automatisch öffnet, versuche es direkt in Safari (nicht aus der App) oder speichere die Datei manuell.</p>
<div id="icsLinkBox"></div></div>
<div id="calendar"></div></div>
<button onclick="exportCalendarToPDF()" style="margin-top: 1em;">📄 Kalender als PDF speichern</button>
</div>
<script>
    function addMedication() {
      const name = document.getElementById("medName").value.trim();
      const dose = document.getElementById("medDose").value.trim();
      const time = document.getElementById("medTime").value;
      const type = document.getElementById("medType").value;

      if (!name || !dose || !time) return alert("Bitte alle Felder ausfüllen.");

      const list = document.getElementById("medList");
      const entry = document.createElement("li");
      entry.textContent = `${time} – ${name} (${dose}, ${type})`;
      list.appendChild(entry);

      // Speichern im localStorage
      const appts = Array.from(document.querySelectorAll('#docList li')).map(li => li.textContent);
      localStorage.setItem('appointments', JSON.stringify(appts));

      // Kalender aktualisieren
      buildCalendar();

      // Speichern im localStorage
      const meds = Array.from(document.querySelectorAll('#medList li')).map(li => li.textContent);
      localStorage.setItem('medications', JSON.stringify(meds));

      // Kalender aktualisieren
      buildCalendar();

      document.getElementById("medName").value = "";
      document.getElementById("medDose").value = "";
      document.getElementById("medTime").value = "";
      document.getElementById("medType").selectedIndex = 0;
    }

    function addAppointment() {
      const date = document.getElementById("docDate").value;
      const time = document.getElementById("docTime").value;
      const name = document.getElementById("docName").value.trim();
      const note = document.getElementById("docNote").value.trim();

      if (!date || !time || !name) return alert("Bitte alle Pflichtfelder ausfüllen.");

      const list = document.getElementById("docList");
      const entry = document.createElement("li");
      entry.textContent = `${date} ${time} – ${name}${note ? " („" + note + "“)" : ""}`;
      list.appendChild(entry);

      // Speichern im localStorage
      const appts = Array.from(document.querySelectorAll('#docList li')).map(li => li.textContent);
      localStorage.setItem('appointments', JSON.stringify(appts));

      // Kalender aktualisieren
      buildCalendar();

      // Speichern im localStorage
      const meds = Array.from(document.querySelectorAll('#medList li')).map(li => li.textContent);
      localStorage.setItem('medications', JSON.stringify(meds));

      // Kalender aktualisieren
      buildCalendar();

      document.getElementById("docDate").value = "";
      document.getElementById("docTime").value = "";
      document.getElementById("docName").value = "";
      document.getElementById("docNote").value = "";
    }

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    function buildCalendar() {
      const appointments = JSON.parse(localStorage.getItem("appointments") || "[]");
      const medications = JSON.parse(localStorage.getItem("medications") || "[]");

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";

      const monthNames = ["Januar", "Februar", "März", "April", "Mai", "Juni",
                          "Juli", "August", "September", "Oktober", "November", "Dezember"];
      document.getElementById("calendarMonth").textContent = monthNames[currentMonth] + " " + currentYear;

      const table = document.createElement("table");
      table.style.width = "100%";
      table.style.borderCollapse = "collapse";
      table.style.textAlign = "center";

      const weekdays = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
      const headerRow = document.createElement("tr");
      weekdays.forEach(day => {
        const th = document.createElement("th");
        th.textContent = day;
        th.style.padding = "0.5em";
        th.style.borderBottom = "2px solid #333";
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      let tr = document.createElement("tr");
      let dayOfWeek = (new Date(currentYear, currentMonth, 1).getDay() + 6) % 7;

      for (let i = 0; i < dayOfWeek; i++) {
        tr.appendChild(document.createElement("td"));
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const td = document.createElement("td");
        td.style.verticalAlign = "top";
        td.style.border = "1px solid #ccc";
        td.style.padding = "0.4em";

        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const entryTitle = document.createElement("div");
        entryTitle.textContent = day;
        td.style.cursor = 'pointer';
        td.addEventListener('click', () => showDayPopup(dateStr));
        entryTitle.style.fontWeight = "bold";
        td.appendChild(entryTitle);

        appointments.forEach(appt => {
          if (appt.startsWith(dateStr)) {
            const entry = document.createElement("div");
            entry.textContent = appt.slice(11);
            entry.style.fontSize = "0.8em";
            entry.style.marginTop = "0.3em";
            entry.style.background = "#dcedc8";
            entry.style.padding = "0.2em";
            entry.style.borderRadius = "4px";
            td.appendChild(entry);
          }
        });

        medications.forEach(med => {
          const medDiv = document.createElement("div");
          medDiv.textContent = "💊 " + med;
          medDiv.style.fontSize = "0.75em";
          medDiv.style.marginTop = "0.2em";
          medDiv.style.background = "#ffe0b2";
          medDiv.style.padding = "0.2em";
          medDiv.style.borderRadius = "4px";
          td.appendChild(medDiv);
        });

        tr.appendChild(td);
        if ((day + dayOfWeek) % 7 === 0 || day === daysInMonth) {
          table.appendChild(tr);
          tr = document.createElement("tr");
        }
      }

      calendar.appendChild(table);
    }

    function changeMonth(offset) {
      currentMonth += offset;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      buildCalendar();
    }

    window.addEventListener("load", buildCalendar);
  </script>
<script>
window.addEventListener("DOMContentLoaded", () => {
  // Medikamente laden
  const meds = JSON.parse(localStorage.getItem("medications") || "[]");
  const medList = document.getElementById("medList");
  meds.forEach(text => {
    const li = document.createElement("li");
    li.textContent = text;
    medList.appendChild(li);
  });

  // Termine laden
  const appts = JSON.parse(localStorage.getItem("appointments") || "[]");
  const docList = document.getElementById("docList");
  appts.forEach(text => {
    const li = document.createElement("li");
    li.textContent = text;
    docList.appendChild(li);
  });

  buildCalendar();
});
</script><script>
async function exportCalendarToPDF() {
  const calendarElement = document.getElementById("calendarExportBlock");
  const canvas = await html2canvas(calendarElement);
  const imgData = canvas.toDataURL("image/png");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
  const imgWidth = canvas.width * ratio;
  const imgHeight = canvas.height * ratio;
  const x = (pageWidth - imgWidth) / 2;
  const y = 10;

  pdf.addImage(imgData, "PNG", x, y, imgWidth, imgHeight);
  pdf.save("kalender_uebersicht.pdf");
}
</script><script>
document.addEventListener("DOMContentLoaded", () => {
  const header = document.getElementById("calendarExportHeader");
  const months = ["Januar", "Februar", "März", "April", "Mai", "Juni",
                  "Juli", "August", "September", "Oktober", "November", "Dezember"];
  const title = "Kalender – " + months[currentMonth] + " " + currentYear;
  if (header) header.textContent = title;
});
</script>
<div class="block" style="text-align: center;">
<h2>⚠️ Datenverwaltung</h2>
<button onclick="clearAllData()" style="background-color:#c62828;">🗑️ Alle Einträge löschen</button>
</div>
<script>
function clearAllData() {
  if (!confirm("Möchtest du wirklich alle gespeicherten Einträge löschen?")) return;

  localStorage.removeItem("medications");
  localStorage.removeItem("appointments");

  const medList = document.getElementById("medList");
  const docList = document.getElementById("docList");

  if (medList) medList.innerHTML = "";
  if (docList) docList.innerHTML = "";

  if (typeof buildCalendar === "function") buildCalendar();

  alert("Alle Einträge wurden erfolgreich gelöscht.");
}
</script>
<div id="dayPopup" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%);
  background:white; padding:1em; box-shadow:0 0 20px rgba(0,0,0,0.3); border-radius:10px; z-index:9999; width:90%; max-width:500px;">
<h3 id="popupDate" style="margin-top:0;"></h3>
<div id="popupContent"></div>
<button onclick="document.getElementById('dayPopup').style.display='none';" style="margin-top:1em; background:#c62828;">Schließen</button>
</div>
<script>
function showDayPopup(dateStr) {
  const popup = document.getElementById("dayPopup");
  const content = document.getElementById("popupContent");
  const dateHeader = document.getElementById("popupDate");

  const meds = JSON.parse(localStorage.getItem("medications") || "[]");
  const appts = JSON.parse(localStorage.getItem("appointments") || "[]");

  const todayAppts = appts.filter(e => e.startsWith(dateStr));
  const displayAppts = todayAppts.length ? "<strong>🩺 Arzttermine:</strong><ul><li>" + todayAppts.map(e => e.slice(11)).join("</li><li>") + "</li></ul>" : "<em>Keine Termine</em>";

  const displayMeds = meds.length ? "<strong>💊 Medikamente:</strong><ul><li>" + meds.join("</li><li>") + "</li></ul>" : "<em>Keine Medikamenten-Einträge</em>";

  content.innerHTML = displayAppts + "<br>" + displayMeds;
  dateHeader.textContent = "📅 Tagesübersicht: " + dateStr;
  popup.style.display = "block";
}
</script><script>
function exportICS() {
  const meds = JSON.parse(localStorage.getItem("medications") || "[]");
  const appts = JSON.parse(localStorage.getItem("appointments") || "[]");
  let content = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Gesundheitsplaner//EN\n";

  function addEvent(startStr, durationMin, title, desc) {
    const dtstart = startStr.replace(/-/g, "") + "T080000";
    const dtend = startStr.replace(/-/g, "") + "T08" + String(30 + durationMin).padStart(2, "0") + "00";
    content += "BEGIN:VEVENT\n";
    content += "DTSTART:" + dtstart + "\n";
    content += "DTEND:" + dtend + "\n";
    content += "SUMMARY:" + title + "\n";
    content += "DESCRIPTION:" + desc + "\n";
    content += "END:VEVENT\n";
  }

  meds.forEach(m => {
    const date = m.slice(0, 10);
    const info = m.slice(11);
    addEvent(date, 10, "💊 Medikament: " + info, "Einnahme");
  });

  appts.forEach(a => {
    const date = a.slice(0, 10);
    const info = a.slice(11);
    addEvent(date, 60, "🩺 Termin: " + info, "Arzttermin");
  });

  content += "END:VCALENDAR";

  const encoded = encodeURIComponent(content);
  const href = "data:text/calendar;charset=utf-8," + encoded;

  const linkBox = document.getElementById("icsLinkBox");
  linkBox.innerHTML = '<p><a href="' + href + '" download="gesundheitsplaner_export.ics">📎 Hier klicken zum Kalender-Download (.ics)</a></p>';
}
</script>
<div class="block" style="text-align:center; margin-top:2em;">
<h2>📤 Kalender-Export</h2>
<p>Du kannst deine Termine als .ics-Datei exportieren:</p>
<a href="github_kalender_export.html" style="padding:0.6em 1.2em; background:#1976d2; color:white; text-decoration:none; border-radius:6px; font-weight:bold;">
    ➤ Zur Kalender-Export-Seite
  </a>
</div>
</body>
</html>
